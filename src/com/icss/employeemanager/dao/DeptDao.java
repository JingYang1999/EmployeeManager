package com.icss.employeemanager.dao;

import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;

import com.icss.employeemanager.entity.DeptEntity;

/**
*部门的数据层操作
*@author Giselle
*/
public class DeptDao extends BaseDao{
    
	//分页查询所有部门信息
	public ArrayList<DeptEntity> findAllDept(int pageSize, int firstCount) throws Exception {
		//1.2 打开连接
		openConnection();
		//3.写sql
		String sql = "select * from t_dep limit ?,?";
		//4.创建预编译对象
		PreparedStatement pst = conn.prepareStatement(sql);
		pst.setInt(1, firstCount);
		pst.setInt(2, pageSize);
		//5.执行sql  查询：executeQuery-返回resultset结果集   增删改：executeUpdate--返回受影响行数
		 ResultSet rs = pst.executeQuery();
		//6.如果查询处理resultset结果集  1.选择什么类型接收数据   2.next() 3.getXX
		 ArrayList<DeptEntity> deps = new ArrayList<DeptEntity>();
		 DeptEntity dep = null;
		 while(rs.next()){
			 dep = new DeptEntity();
			 dep.setDepid(rs.getInt(1));
			 dep.setDepname(rs.getString(2));
			 dep.setDepdetail(rs.getString(3));
			 deps.add(dep);
		 }
		return deps;
	}
    
	//获取部门总数
	public int getDeptCount() throws Exception {
		// 1.2 打开连接
		openConnection();
		// 3.写sql
		String sql = "select count(*) from t_dep";
		// 4.创建预编译对象
		PreparedStatement pst = conn.prepareStatement(sql);
		// 5.执行sql 查询：executeQuery-返回resultset结果集 增删改：executeUpdate--返回受影响行数
		ResultSet rs = pst.executeQuery();
		// 6.如果查询处理resultset结果集 1.选择什么类型接收数据 2.next() 3.getXX
		int count = 0;
		while(rs.next()){
			count = rs.getInt(1);
		}
		return count;
	}
	
	//删除部门
	public void delDep(String[] ids) throws Exception {
		// 1.2 打开连接
		openConnection();
		// 3.写sql
		String wherein="where depid in(";
		for (int i=0;i<ids.length;i++) {
			if(i==ids.length-1) {
				wherein+=ids[i];
			}else {
				wherein+=ids[i]+",";
			}
			wherein+=")";
		}
		String sql = "delete from t_dep "+wherein;
		// 4.创建预编译对象
		PreparedStatement pst = conn.prepareStatement(sql);
		// 5.执行sql 查询：executeQuery-返回resultset结果集 增删改：executeUpdate--返回受影响行数
		//ResultSet rs = pst.executeQuery();
		pst.executeUpdate();
		// 6.如果查询处理resultset结果集 1.选择什么类型接收数据 2.next() 3.getXX
		
		
	}
	//检查部门名称是否重复
	public boolean checkDepName(String depname) throws Exception {
		// TODO Auto-generated method stub
		//1.2 打开连接
			openConnection();
			//3.写sql
			String sql = "select * from t_dep where depname=?";
			//4.创建预编译对象
			PreparedStatement pst = conn.prepareStatement(sql);
			pst.setString(1, depname);
			//5.执行sql  查询：executeQuery-返回resultset结果集   增删改：executeUpdate--返回受影响行数
			ResultSet rs;
			rs = pst.executeQuery();
			//6.如果查询处理resultset结果集  1.选择什么类型接收数据   2.next() 3.getXX
			int depid=0;
			while(rs.next()){
				depid=rs.getInt(1);
			}
			 boolean result=false;
			if(depid==0){
				result=true;
			}
		return result;
	}
	//添加部门
	public int insertDep(String depname, String depdetail) throws Exception {
		openConnection();
		String sql = "insert into t_dep(depname,depdetail) values(?,?) ";
		PreparedStatement pst = conn.prepareStatement(sql);
		pst.setString(1,depname);
		pst.setString(2,depdetail);
		
		int res=pst.executeUpdate();
		return res;
	}
	

	public void updateDep(String depid, String depname, String depdetail) throws SQLException {
		// TODO Auto-generated method stub
		int res=0;
		try {
			openConnection();
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		String sql = "update t_dep set depname=?,depdetail=? where depid =?";
		PreparedStatement pst = conn.prepareStatement(sql);
		pst.setString(1,depname);
		pst.setString(2,depdetail);
		res=Integer.parseInt(depid);
		pst.setInt(3,res);
		
		pst.executeUpdate();
	}
}
